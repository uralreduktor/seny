# Валидация AI компонентов

## Обзор

Данный документ описывает процесс валидации и тестирования AI/ML компонентов системы: OCR, RAG и AI-ассистента.

## OCR (Optical Character Recognition)

### Метрики качества

#### Точность распознавания текста
- **Цель**: >90% для печатного текста
- **Метрика**: Character Error Rate (CER) и Word Error Rate (WER)
- **Измерение**: Сравнение распознанного текста с эталонным

#### Извлечение параметров
- **Цель**: >80% ключевых параметров извлечено корректно
- **Ключевые параметры**: мощность, передаточное число, тип редуктора, размеры
- **Метрика**: Precision и Recall для каждого типа параметра

#### Время обработки
- **Цель**: <600 секунд для сложного чертежа
- **Измерение**: Среднее время обработки на тестовом наборе

### Тестовый набор данных

#### Состав тестового набора
- **Минимум**: 100 чертежей различных типов
- **Форматы**: PDF (50%), DWG (30%), STEP (20%)
- **Сложность**: простые (30%), средние (50%), сложные (20%)

#### Критерии оценки
1. **Печатный текст**: точность >95%
2. **Рукописный текст**: точность >70% (если присутствует)
3. **Таблицы**: точность структуры >85%
4. **Размеры и параметры**: точность >90%

### Процесс валидации

1. **Подготовка эталонных данных**
   - Ручная разметка параметров на тестовых чертежах
   - Создание JSON файлов с эталонными значениями

2. **Запуск OCR**
   - Обработка всех чертежей из тестового набора
   - Сохранение результатов

3. **Сравнение с эталоном**
   - Автоматическое сравнение извлечённых параметров
   - Расчёт метрик точности

4. **Анализ ошибок**
   - Категоризация типов ошибок
   - Выявление проблемных паттернов
   - Улучшение модели при необходимости

### Пример тестового случая

```python
def test_ocr_extraction():
    # Загрузка тестового чертежа
    drawing = load_test_drawing("test_reducer_001.pdf")
    
    # Обработка через OCR
    result = process_drawing_ocr(drawing)
    
    # Сравнение с эталоном
    expected = {
        "power": 5.0,
        "gear_ratio": 50,
        "type": "червячный"
    }
    
    assert result["power"] == expected["power"]
    assert result["gear_ratio"] == expected["gear_ratio"]
    assert result["type"] == expected["type"]
```

## RAG (Retrieval-Augmented Generation)

### Метрики качества

#### Релевантность поиска
- **Цель**: >70% релевантных результатов в топ-5
- **Метрика**: Precision@5, Recall@5, MRR (Mean Reciprocal Rank)
- **Измерение**: Ручная оценка релевантности результатов

#### Время отклика
- **Цель**: <2 секунды
- **Измерение**: Среднее время отклика на тестовых запросах

#### Качество ответов AI-ассистента
- **Цель**: Оценка пользователями >4/5
- **Метрика**: Средняя оценка на тестовых запросах
- **Критерии**: Точность, полезность, понятность

### Тестовый набор данных

#### Тестовые запросы
- **Минимум**: 50 различных запросов
- **Типы запросов**:
  - Поиск по параметрам (30%)
  - Поиск по естественному языку (40%)
  - Вопросы к AI-ассистенту (30%)

#### Эталонные ответы
- Для каждого запроса подготовлены эталонные результаты
- Ручная оценка релевантности для топ-10 результатов

### Процесс валидации

1. **Подготовка тестовых запросов**
   - Создание набора разнообразных запросов
   - Подготовка эталонных ответов

2. **Запуск поиска**
   - Выполнение всех тестовых запросов
   - Сохранение результатов поиска

3. **Оценка релевантности**
   - Ручная оценка релевантности результатов
   - Расчёт метрик Precision, Recall, MRR

4. **Оценка ответов AI**
   - Оценка качества ответов AI-ассистента
   - Проверка на галлюцинации и неточности

5. **Анализ и улучшение**
   - Выявление проблемных паттернов
   - Настройка параметров поиска
   - Улучшение промптов для LLM

### Пример тестового случая

```python
def test_rag_search():
    query = "червячный редуктор i=50 мощность 5 кВт"
    
    # Выполнение поиска
    results = search_similar_calculations(query, limit=5)
    
    # Проверка релевантности
    relevant_count = sum(1 for r in results if r["relevance_score"] > 0.7)
    assert relevant_count >= 3  # Минимум 3 из 5 релевантных
    
    # Проверка времени отклика
    assert search_time < 2.0
```

## AI-ассистент

### Метрики качества

#### Точность ответов
- **Цель**: >85% правильных ответов
- **Метрика**: Точность на тестовом наборе вопросов

#### Полезность ответов
- **Цель**: Оценка пользователями >4/5
- **Метрика**: Средняя оценка полезности

#### Время генерации ответа
- **Цель**: <5 секунд
- **Измерение**: Среднее время генерации ответа

### Тестовые сценарии

#### Проверка расчётов
- Тестирование на наборе расчётов с известными ошибками
- Проверка способности обнаруживать ошибки
- Проверка качества предложений по исправлению

#### Ответы на вопросы
- Тестирование на наборе типичных вопросов инженеров
- Проверка точности и полноты ответов
- Проверка использования контекста из базы знаний

### Процесс валидации

1. **Подготовка тестовых данных**
   - Набор расчётов с ошибками
   - Набор типичных вопросов
   - Эталонные ответы

2. **Запуск валидации**
   - Проверка расчётов через AI-ассистента
   - Запросы к AI-ассистенту
   - Сохранение результатов

3. **Оценка результатов**
   - Сравнение с эталонными ответами
   - Оценка пользователями
   - Расчёт метрик

4. **Улучшение**
   - Анализ ошибок
   - Настройка промптов
   - Обновление контекста базы знаний

## Автоматизация валидации

### CI/CD интеграция

Валидация AI компонентов запускается:
- При изменении AI кода
- Еженедельно на полном тестовом наборе
- Перед релизом

### Дашборд метрик

Планируется создание дашборда для отслеживания:
- Текущих метрик качества
- Трендов изменения метрик
- Сравнения с предыдущими версиями

## Критерии приёмки

### Для OCR
- ✅ Точность распознавания >90%
- ✅ Извлечение параметров >80%
- ✅ Время обработки <600 секунд

### Для RAG
- ✅ Релевантность поиска >70% в топ-5
- ✅ Время отклика <2 секунды
- ✅ Оценка ответов >4/5

### Для AI-ассистента
- ✅ Точность ответов >85%
- ✅ Оценка полезности >4/5
- ✅ Время генерации <5 секунд

---

**Связанные документы:**
- [AI компоненты](../architecture/ai_components.md)
- [План тестирования](./test_plan.md)
- [Архитектура системы](../architecture/system_architecture.md)

