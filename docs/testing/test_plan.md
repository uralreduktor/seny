# План тестирования

## Обзор

Данный документ описывает стратегию тестирования системы TenderFlow KB AI, включая типы тестов, инструменты и критерии приёмки.

## Типы тестов

### 1. Unit тесты (Модульные тесты)

**Назначение**: Тестирование отдельных функций и классов изолированно.

**Инструменты**:

- **Backend**: Pytest
- **Frontend**: Vitest

**Покрытие**: >80% кода

**Примеры**:

- Тестирование функций расчёта стоимости
- Тестирование валидации данных (Pydantic модели)
- Тестирование утилитарных функций
- Тестирование React компонентов

### 2. Integration тесты (Интеграционные тесты)

**Назначение**: Тестирование взаимодействия между компонентами системы.

**Инструменты**:

- **Backend**: Pytest с тестовой БД
- **Frontend**: Vitest с моками API

**Примеры**:

- Тестирование API эндпоинтов
- Тестирование взаимодействия с БД
- Тестирование интеграции с внешними сервисами (MinIO, Redis)
- Тестирование RAG pipeline

### 3. E2E тесты (End-to-End тесты)

**Назначение**: Тестирование полных пользовательских сценариев.

**Инструменты**:

- **Планируется**: Cypress или Playwright

**Примеры**:

- Полный цикл подготовки тендерного предложения
- Поиск похожих расчётов
- Генерация ТКП

### 4. Performance тесты (Нагрузочные тесты)

**Назначение**: Проверка производительности системы под нагрузкой.

**Инструменты**:

- **Планируется**: Locust или k6

**Метрики**:

- Время отклика API <500ms (95-й перцентиль)
- Поиск по базе знаний <2 секунды
- Генерация ТКП <2 минуты
- Обработка чертежа <600 секунд

### 5. Security тесты (Тесты безопасности)

**Назначение**: Проверка безопасности системы.

**Примеры**:

- Тестирование аутентификации и авторизации
- Тестирование SQL injection защита
- Тестирование XSS защита
- Тестирование шифрования данных

## Тестирование AI компонентов

### OCR валидация

**Критерии**:

- Точность OCR >90% для печатного текста
- Извлечение >80% ключевых параметров
- Время обработки <600 секунд

**Тестовые данные**:

- Набор чертежей различных форматов (PDF, DWG, STEP)
- Различные стили оформления
- Различные углы поворота текста

### RAG валидация

**Критерии**:

- Точность поиска >70% релевантных результатов в топ-5
- Время отклика <2 секунды
- Качество ответов AI-ассистента >4/5 (оценка пользователями)

**Тестовые данные**:

- Набор тестовых запросов
- База знаний с известными расчётами
- Метрики оценки релевантности

## Структура тестов

### Backend тесты

```text
backend/
├── tests/
│   ├── unit/
│   │   ├── test_calculations.py
│   │   ├── test_tenders.py
│   │   └── test_utils.py
│   ├── integration/
│   │   ├── test_api_tenders.py
│   │   ├── test_api_calculations.py
│   │   └── test_db_operations.py
│   ├── ai/
│   │   ├── test_ocr.py
│   │   ├── test_rag.py
│   │   └── test_ai_assistant.py
│   └── fixtures/
│       ├── test_data.py
│       └── conftest.py
```

### Frontend тесты

```text
frontend/
├── src/
│   └── __tests__/
│       ├── components/
│       ├── hooks/
│       └── utils/
└── e2e/
    └── scenarios/
```

## Запуск тестов

### Backend

```bash
cd backend
pytest tests/ -v --cov=app --cov-report=html
```

### Frontend

```bash
cd frontend
npm run test
```

### E2E тесты (планируется)

```bash
npm run test:e2e
```

## CI/CD интеграция

Тесты автоматически запускаются при:

- Push в main branch
- Создании Pull Request
- Ночных сборках (для длительных тестов)

## Критерии приёмки

### Для каждого Pull Request

- Все unit тесты проходят
- Покрытие кода не снижается
- Нет критических багов
- Code review одобрен

### Для релиза

- Все тесты проходят (unit, integration, E2E)
- Покрытие кода >80%
- Performance тесты проходят
- Security тесты проходят
- Документация обновлена

## Метрики качества

### Покрытие кода

- **Цель**: >80%
- **Критический минимум**: >70%

### Количество багов

- **Критические**: 0
- **Высокие**: <5 на релиз
- **Средние/Низкие**: отслеживаются через issue tracker

### Время выполнения тестов

- **Unit тесты**: <30 секунд
- **Integration тесты**: <5 минут
- **E2E тесты**: <15 минут

## Отчёты

Результаты тестирования публикуются в:

- GitHub Actions artifacts
- Внутренний дашборд (планируется)
- Отчёты о покрытии кода (HTML)

---

**Связанные документы:**

- [Валидация AI компонентов](./ai_validation.md)
- [Стандарты кодирования](../development/coding_standards.md)
- [Архитектура системы](../architecture/system_architecture.md)
