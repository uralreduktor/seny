# Модуль управления торгами (Tender Management)

## Обзор

Модуль управления торгами обеспечивает полный жизненный цикл участия в тендерных закупках: от импорта тендеров до анализа результатов.

## Основные функции

### 1. Импорт тендеров

**Источники**:
- ЕИС (zakupki.gov.ru)
- Сбербанк-АСТ
- Росэлторг
- Коммерческие ЭТП
- Ручной ввод

**Функциональность**:
- Автоматический импорт по расписанию
- Парсинг тендерной документации
- Извлечение ключевых параметров (дедлайн, бюджет, требования)
- Создание карточек тендеров в системе

### 2. Управление жизненным циклом

**Стадии тендера**:
1. Обнаружен — тендер импортирован или создан вручную
2. На рассмотрении — назначен ответственный, анализируется
3. В работе — ведётся подготовка предложения
4. Расчёт стоимости — выполняются инженерные расчёты
5. Подготовка документов — формируется ТКП и комплект документов
6. Подача — документы отправлены на ЭТП
7. Ожидание результатов — ожидание решения заказчика
8. Выигран / Проигран — финальный статус

**Настраиваемые стадии**:
- Администратор может создавать кастомные стадии
- Настройка переходов между стадиями
- Автоматические действия при смене стадии

### 3. Канбан-доска

**Функциональность**:
- Визуализация тендеров по стадиям
- Drag & drop для перемещения между стадиями
- Фильтрация по ответственным, дедлайнам, статусам
- Поиск по названию, номеру, заказчику

**Отображение**:
- Карточки тендеров с ключевой информацией
- Цветовая индикация по приоритету и дедлайну
- Счётчики тендеров по стадиям

### 4. Календарь дедлайнов

**Функциональность**:
- Отображение дедлайнов в календарном виде
- Фильтрация по периодам (день, неделя, месяц)
- Уведомления о приближающихся дедлайнах
- Экспорт в календарные приложения (iCal)

### 5. Задачи и чек-листы

**Функциональность**:
- Создание задач для тендера
- Назначение ответственных
- Чек-листы обязательных действий
- Отслеживание прогресса выполнения

**Типы задач**:
- Технические (расчёт стоимости, анализ ТЗ)
- Документальные (подготовка ТКП, сбор документов)
- Административные (получение ЭЦП, банковской гарантии)

### 6. Уведомления

**Каналы**:
- Email
- Telegram (через бота)
- Внутренние уведомления в системе

**Типы уведомлений**:
- Приближение дедлайна (за 7, 3, 1 день)
- Назначение ответственным
- Изменение статуса тендера
- Новые комментарии или задачи
- Результаты тендера

### 7. Назначение ответственных

**Функциональность**:
- Назначение главного ответственного за тендер
- Назначение исполнителей по задачам
- Делегирование полномочий
- История назначений

### 8. Аналитика

**Метрики**:
- Воронка тендеров (по стадиям)
- Загрузка сотрудников
- Процент выигрышей
- Среднее время подготовки предложения
- Количество поданных заявок

**Отчёты**:
- Еженедельные отчёты по активности
- Ежемесячные отчёты по результативности
- Анализ причин проигрышей
- Прогноз загрузки на следующий период

## API Endpoints

### Тендеры

- `GET /api/v1/tenders` — список тендеров (с фильтрацией и пагинацией)
- `GET /api/v1/tenders/{id}` — детали тендера
- `POST /api/v1/tenders` — создание тендера
- `PUT /api/v1/tenders/{id}` — обновление тендера
- `DELETE /api/v1/tenders/{id}` — удаление тендера
- `POST /api/v1/tenders/{id}/import` — импорт с ЭТП

### Стадии и задачи

- `GET /api/v1/tenders/{id}/stages` — стадии тендера
- `PUT /api/v1/tenders/{id}/stage` — изменение стадии
- `GET /api/v1/tenders/{id}/tasks` — задачи тендера
- `POST /api/v1/tenders/{id}/tasks` — создание задачи
- `PUT /api/v1/tasks/{id}` — обновление задачи

### Канбан

- `GET /api/v1/kanban` — данные для канбан-доски
- `PUT /api/v1/tenders/{id}/position` — изменение позиции на канбане

### Аналитика

- `GET /api/v1/analytics/funnel` — данные воронки
- `GET /api/v1/analytics/workload` — загрузка сотрудников
- `GET /api/v1/analytics/win-rate` — процент выигрышей

## Модели данных

### Tender (Тендер)

```python
class Tender(Base):
    id: int
    number: str  # Номер тендера
    title: str  # Название
    customer: str  # Заказчик
    deadline: datetime  # Дедлайн подачи
    budget: Decimal  # Бюджет закупки
    stage: str  # Текущая стадия
    responsible_id: int  # Ответственный
    source: str  # Источник (ЕИС, Сбербанк-АСТ и т.д.)
    created_at: datetime
    updated_at: datetime
```

### Task (Задача)

```python
class Task(Base):
    id: int
    tender_id: int
    title: str
    description: str
    assignee_id: int  # Исполнитель
    status: str  # pending, in_progress, completed
    due_date: datetime
    created_at: datetime
```

## Интеграции

### Интеграция с ЭТП

- Парсинг XML/JSON данных с площадок
- Автоматическое обновление статусов
- Синхронизация документов

### Интеграция с другими модулями

- **Pricing KB AI**: Связь тендера с расчётами стоимости
- **DocFlow**: Генерация документов для тендера

## Пользовательские сценарии

### Сценарий 1: Импорт и обработка тендера

1. Система автоматически импортирует тендер с ЕИС
2. Создаётся карточка тендера со статусом "Обнаружен"
3. Менеджер просматривает тендер и назначает ответственного
4. Статус меняется на "На рассмотрении"
5. Создаются задачи для подготовки предложения

### Сценарий 2: Отслеживание дедлайнов

1. Система проверяет дедлайны каждый час
2. За 7 дней до дедлайна отправляется уведомление ответственному
3. За 3 дня — повторное уведомление + уведомление руководителю
4. За 1 день — критическое уведомление всем участникам

### Сценарий 3: Анализ эффективности

1. Руководитель открывает раздел "Аналитика"
2. Просматривает воронку тендеров по стадиям
3. Анализирует загрузку сотрудников
4. Выявляет узкие места в процессе
5. Принимает решения по оптимизации

---

**Связанные документы:**
- [Обзор проекта](../overview/project_overview.md)
- [API документация](../development/api_docs.md)
- [Пользовательские сценарии](../functional/scenarios.md)

