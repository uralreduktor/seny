# API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

> **ü§ñ –î–ª—è AI-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞**:
>
> 1. **Source of Truth**: –ò—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ —è–≤–ª—è–µ—Ç—Å—è –∫–æ–¥ (FastAPI Pydantic models) –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–∞—è OpenAPI —Å—Ö–µ–º–∞.
> 2. **Host**: –û—Å–Ω–æ–≤–Ω–æ–π —Ö–æ—Å—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ ‚Äî `https://seny.uralreduktor.com`. –õ–æ–∫–∞–ª—å–Ω–æ ‚Äî `http://localhost:8000`.
> 3. **Prefix**: –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏–º–µ—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `/api/v1`.
> 4. **Auth**: –ò—Å–ø–æ–ª—å–∑—É–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <token>` –¥–ª—è –≤—Å–µ—Ö –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤.

## üåê –ë–∞–∑–æ–≤—ã–µ URL

| –û–∫—Ä—É–∂–µ–Ω–∏–µ        | URL                             | –ü—É—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ  |
| ---------------- | ------------------------------- | ---------------- |
| **Production**   | `https://seny.uralreduktor.com` | `/var/www/seny/` |
| **Local Dev**    | `http://localhost:8000`         | -                |
| **OpenAPI JSON** | `/openapi.json`                 | -                |
| **Swagger UI**   | `/docs`                         | -                |
| **ReDoc**        | `/redoc`                        | -                |

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (JWT)

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OAuth2 Password Bearer flow.

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

**POST** `/api/v1/auth/login`

```json
// Request (multipart/form-data or json)
{
  "username": "user@example.com", // –ø–æ–ª–µ username –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è email
  "password": "password123"
}
```

**Response (200 OK)**:

```json
{
  "access_token": "eyJhbGciOiJIUz...",
  "token_type": "bearer",
  "expires_in": 1800 // 30 –º–∏–Ω—É—Ç
}
```

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

–î–æ–±–∞–≤—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–æ –≤—Å–µ–º –∑–∞–ø—Ä–æ—Å–∞–º:
`Authorization: Bearer eyJhbGciOiJIUz...`

---

## üì¶ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤

### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç

FastAPI –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –∏–ª–∏ –∑–∞–≤–µ—Ä–Ω—É—Ç—ã–µ –≤ –º–æ–¥–µ–ª—å –æ—Ç–≤–µ—Ç–∞.

```json
// GET /api/v1/tenders/1
{
  "id": 1,
  "title": "–ü–æ—Å—Ç–∞–≤–∫–∞ —Ä–µ–¥—É–∫—Ç–æ—Ä–æ–≤",
  "status": "success" // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ö–µ–º—ã
}
```

### –û—à–∏–±–∫–∞ (HTTP 4xx/5xx)

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—à–∏–±–∫–∏ FastAPI (`HTTPException`):

```json
{
  "detail": "–¢–µ–Ω–¥–µ—Ä —Å id 1 –Ω–µ –Ω–∞–π–¥–µ–Ω"
}
```

–ò–ª–∏ —Å–ª–æ–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (`RequestValidationError`):

```json
{
  "detail": [
    {
      "loc": ["body", "price"],
      "msg": "field required",
      "type": "value_error.missing"
    }
  ]
}
```

---

## üõ†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (Overview)

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ Swagger UI (`/docs`). –ó–¥–µ—Å—å –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –∫–ª—é—á–µ–≤—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

### üìã –¢–µ–Ω–¥–µ—Ä—ã (Tender Management)

| –ú–µ—Ç–æ–¥  | –ü—É—Ç—å                         | –û–ø–∏—Å–∞–Ω–∏–µ                             |
| ------ | ---------------------------- | ------------------------------------ |
| `GET`  | `/api/v1/tenders/`           | –°–ø–∏—Å–æ–∫ —Ç–µ–Ω–¥–µ—Ä–æ–≤ (—Ñ–∏–ª—å—Ç—Ä—ã, –ø–∞–≥–∏–Ω–∞—Ü–∏—è) |
| `POST` | `/api/v1/tenders/`           | –°–æ–∑–¥–∞—Ç—å —Ç–µ–Ω–¥–µ—Ä                       |
| `GET`  | `/api/v1/tenders/{id}`       | –î–µ—Ç–∞–ª–∏ —Ç–µ–Ω–¥–µ—Ä–∞                       |
| `PUT`  | `/api/v1/tenders/{id}/stage` | –°–º–µ–Ω–∞ —Å—Ç–∞–¥–∏–∏ (State Machine)         |
| `GET`  | `/api/v1/kanban/`            | –î–∞–Ω–Ω—ã–µ –¥–ª—è –ö–∞–Ω–±–∞–Ω-–¥–æ—Å–∫–∏              |

### üß† –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –∏ –†–∞—Å—á—ë—Ç—ã (Pricing KB)

| –ú–µ—Ç–æ–¥  | –ü—É—Ç—å                         | –û–ø–∏—Å–∞–Ω–∏–µ                              |
| ------ | ---------------------------- | ------------------------------------- |
| `POST` | `/api/v1/search/similar`     | RAG –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Ä–∞—Å—á—ë—Ç–æ–≤            |
| `GET`  | `/api/v1/calculations/`      | –°–ø–∏—Å–æ–∫ —Ä–∞—Å—á—ë—Ç–æ–≤                       |
| `POST` | `/api/v1/ai/assistant/query` | –ó–∞–ø—Ä–æ—Å –∫ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É (Context Chat) |
| `POST` | `/api/v1/ocr/process`        | –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä—Ç–µ–∂–∞ –Ω–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ     |

### üß± –ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞

| –ú–µ—Ç–æ–¥  | –ü—É—Ç—å                         | –û–ø–∏—Å–∞–Ω–∏–µ                                            |
| ------ | ---------------------------- | --------------------------------------------------- |
| `GET`  | `/api/v1/nomenclature/nodes` | –ò–µ—Ä–∞—Ä—Ö–∏—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞                             |
| `GET`  | `/api/v1/nomenclature/cards` | –ù–æ–≤—ã–π –≥–∏–±–∫–∏–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–∞—Ä—Ç–æ—á–µ–∫                    |
| `GET`  | `/api/v1/nomenclatures/`     | **Legacy**: —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å–ø–∏—Å–æ–∫ (–Ω–∞–∑–≤–∞–Ω–∏–µ/–ø–∞—Ä–∞–º–µ—Ç—Ä—ã) |
| `POST` | `/api/v1/nomenclatures/`     | **Legacy**: —Å–æ–∑–¥–∞–Ω–∏–µ –≤ —Å—Ç–∞—Ä–æ–º —Ñ–æ—Ä–º–∞—Ç–µ               |

> ‚ö†Ô∏è –°–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å–ª–æ–π `/api/v1/nomenclatures/*` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞. –ù–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (lifecycle, —Å—Ö–µ–º—ã, –≤–µ—Ä—Å–∏–∏) –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `/api/v1/nomenclature/*`.

### üìÑ –î–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç (DocFlow)

| –ú–µ—Ç–æ–¥  | –ü—É—Ç—å                             | –û–ø–∏—Å–∞–Ω–∏–µ                       |
| ------ | -------------------------------- | ------------------------------ |
| `POST` | `/api/v1/tkp/generate`           | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –¢–ö–ü (Async Task) |
| `POST` | `/api/v1/documents/fill`         | –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞         |
| `GET`  | `/api/v1/packages/{id}/download` | –°–∫–∞—á–∞—Ç—å ZIP –∞—Ä—Ö–∏–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤   |

---

## üö¶ Rate Limiting

API –∑–∞—â–∏—â–µ–Ω –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ (Throttling):

- **Anonymous**: 10 req/min
- **User**: 100 req/min
- **AI Endpoints**: 20 req/min (–¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)

–ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `429 Too Many Requests`.

---

## üîÑ Webhooks (Planned)

–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤:

- `tender.stage_changed`
- `ocr.completed`
- `tkp.generated`

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [System Architecture](../architecture/system_architecture.md)
- [Data Models](../architecture/data_models.md)
- [Backend Development Guide](./backend_guide.md)
