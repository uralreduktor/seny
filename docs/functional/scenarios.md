# Пользовательские сценарии использования

## Обзор

Данный документ описывает ключевые пользовательские сценарии использования системы TenderFlow KB AI для различных ролей пользователей.

## Роли пользователей

- **Инженер-сметчик** — выполняет расчёты стоимости, работает с базой знаний
- **Менеджер тендерного отдела** — управляет тендерами, готовит документацию
- **Руководитель** — контролирует процесс, анализирует результаты

## Сценарии модуля "Управление торгами"

### Сценарий 1: Импорт и обработка нового тендера

**Роль**: Менеджер тендерного отдела

**Предусловия**:

- Менеджер авторизован в системе
- Настроен автоматический импорт с ЕИС

**Шаги**:

1. Система автоматически импортирует тендер с ЕИС по расписанию
2. Создаётся карточка тендера со статусом "Обнаружен"
3. Менеджер получает уведомление о новом тендере
4. Менеджер открывает карточку тендера и просматривает детали
5. Менеджер назначает ответственного инженера
6. Статус тендера меняется на "На рассмотрении"
7. Создаются задачи для подготовки предложения

**Результат**: Тендер обработан, назначен ответственный, созданы задачи

**Альтернативный поток**: Менеджер может импортировать тендер вручную через форму создания

---

### Сценарий 2: Отслеживание дедлайнов через календарь

**Роль**: Менеджер тендерного отдела

**Предусловия**:

- В системе есть тендеры с установленными дедлайнами

**Шаги**:

1. Менеджер открывает раздел "Календарь дедлайнов"
2. Выбирает период отображения (неделя/месяц)
3. Просматривает тендеры с дедлайнами в выбранном периоде
4. Видит цветовую индикацию по приоритету
5. Кликает на тендер для просмотра деталей
6. При необходимости экспортирует календарь в iCal

**Результат**: Менеджер видит все дедлайны и может планировать работу

**Альтернативный поток**: Система отправляет уведомления о приближающихся дедлайнах

---

### Сценарий 3: Управление тендерами через канбан-доску

**Роль**: Менеджер тендерного отдела

**Предусловия**:

- В системе есть тендеры на разных стадиях

**Шаги**:

1. Менеджер открывает канбан-доску
2. Видит тендеры, распределённые по стадиям
3. Фильтрует тендеры по ответственному
4. Перетаскивает карточку тендера в другую стадию (drag & drop)
5. Система автоматически обновляет статус тендера
6. Ответственный получает уведомление об изменении статуса

**Результат**: Статус тендера обновлён, все заинтересованные уведомлены

---

## Сценарии модуля "База знаний по ценообразованию с AI"

### Сценарий 4: Поиск похожего расчёта

**Роль**: Инженер-сметчик

**Предусловия**:

- В базе знаний есть исторические расчёты
- Инженер авторизован в системе

**Шаги**:

1. Инженер начинает работу над новым проектом
2. Открывает раздел "База знаний"
3. Вводит запрос: "червячный редуктор i=50 мощность 5 кВт"
4. Система генерирует embedding и выполняет векторный поиск
5. Отображаются топ-5 похожих расчётов с процентом совпадения
6. Инженер просматривает детали найденных расчётов
7. Выбирает наиболее подходящий расчёт
8. Клонирует расчёт для нового проекта
9. Вносит изменения под новый проект

**Результат**: Инженер нашёл похожий расчёт и использовал его как основу

**Альтернативный поток**: Если похожих расчётов нет, инженер создаёт новый с нуля

---

### Сценарий 5: Обработка чертежа через OCR

**Роль**: Инженер-сметчик

**Предусловия**:

- Инженер имеет чертёж в формате PDF/DWG/STEP
- Инженер авторизован в системе

**Шаги**:

1. Инженер создаёт новый расчёт
2. Загружает чертёж в систему
3. Система создаёт задачу OCR в фоновой очереди
4. Инженер получает уведомление о начале обработки
5. Фоновая обработка: YOLOv11 детектирует объекты, EasyOCR распознаёт текст
6. Система извлекает параметры (мощность, передаточное число и т.д.)
7. Инженер получает уведомление о завершении обработки
8. Инженер просматривает извлечённые параметры
9. Корректирует параметры при необходимости
10. Сохраняет расчёт с прикреплённым чертежом

**Результат**: Параметры извлечены из чертежа и сохранены в расчёте

**Альтернативный поток**: Если OCR не смог извлечь параметры, инженер вводит их вручную

---

### Сценарий 6: Использование AI-ассистента для проверки расчёта

**Роль**: Инженер-сметчик

**Предусловия**:

- Инженер завершил расчёт стоимости
- Инженер авторизован в системе

**Шаги**:

1. Инженер завершает расчёт и нажимает кнопку "Проверить через AI"
2. AI-ассистент анализирует расчёт с использованием RAG из базы знаний
3. Проверяет расчёт на типичные ошибки
4. Предлагает оптимизации стоимости
5. Объясняет методику расчёта
6. Отображает похожие проекты для сравнения
7. Инженер просматривает рекомендации AI
8. Принимает или отклоняет предложения
9. Сохраняет финальную версию расчёта

**Результат**: Расчёт проверен и оптимизирован с помощью AI

---

## Сценарии модуля "Подготовка тендерной документации"

### Сценарий 7: Генерация ТКП в один клик

**Роль**: Инженер-сметчик

**Предусловия**:

- Инженер завершил расчёт стоимости
- Тендер связан с расчётом
- Инженер авторизован в системе

**Шаги**:

1. Инженер завершает расчёт стоимости
2. Нажимает кнопку "Сформировать ТКП"
3. Система подтягивает все данные из расчёта и тендера
4. Генерирует технико-коммерческое предложение в фирменном стиле
5. Генерация выполняется за <2 минут
6. Инженер получает уведомление о готовности ТКП
7. Инженер просматривает сгенерированный документ
8. Вносит правки при необходимости
9. Сохраняет финальную версию ТКП

**Результат**: ТКП сгенерирован и готов к использованию

---

### Сценарий 8: Автозаполнение формы заказчика

**Роль**: Менеджер тендерного отдела

**Предусловия**:

- В системе есть шаблон формы заказчика
- Есть связанный расчёт и тендер
- Менеджер авторизован в системе

**Шаги**:

1. Менеджер открывает карточку тендера
2. Выбирает форму заказчика из библиотеки шаблонов
3. Нажимает "Заполнить автоматически"
4. Система извлекает данные из расчёта и тендера
5. Автоматически заполняет все помеченные поля в форме
6. Менеджер просматривает предпросмотр заполненной формы
7. Корректирует данные при необходимости
8. Сохраняет заполненную форму

**Результат**: Форма заказчика заполнена автоматически

---

### Сценарий 9: Комплектование и подписание пакета документов

**Роль**: Менеджер тендерного отдела

**Предусловия**:

- Тендер готов к подаче
- Все документы подготовлены
- Менеджер авторизован в системе
- Подключён токен Рутокен

**Шаги**:

1. Менеджер открывает карточку тендера
2. Нажимает кнопку "Скачать полный пакет для подачи"
3. Система собирает все документы: ТКП, расчёт, чертежи, сертификаты
4. Проверяет полноту пакета по чек-листу
5. Формирует структурированный zip-архив
6. Менеджер выбирает документы для подписания
7. Подключает токен Рутокен
8. Вводит PIN-код
9. Подписывает документы
10. Скачивает готовый подписанный пакет для подачи на ЭТП

**Результат**: Пакет документов собран, подписан и готов к подаче

---

## Комплексные сценарии

### Сценарий 10: Полный цикл подготовки тендерного предложения

**Роли**: Менеджер тендерного отдела, Инженер-сметчик

**Предусловия**:

- Тендер импортирован в систему
- Назначен ответственный инженер

**Шаги**:

1. **Импорт тендера** (Менеджер)
   - Тендер импортирован автоматически или вручную
   - Назначен ответственный инженер

2. **Расчёт стоимости** (Инженер)
   - Инженер ищет похожие расчёты в базе знаний
   - Клонирует подходящий расчёт или создаёт новый
   - Загружает чертёж и обрабатывает через OCR
   - Проверяет расчёт через AI-ассистента
   - Сохраняет финальный расчёт

3. **Генерация ТКП** (Инженер)
   - Генерирует ТКП в один клик
   - Просматривает и корректирует при необходимости
   - Сохраняет ТКП

4. **Подготовка документов** (Менеджер)
   - Заполняет формы заказчика автоматически
   - Комплектует пакет документов
   - Подписывает документы

5. **Подача на ЭТП** (Менеджер)
   - Экспортирует пакет в формат ЭТП
   - Подаёт документы на площадку
   - Обновляет статус тендера на "Подача"

**Результат**: Полный цикл подготовки тендерного предложения завершён

---

**Связанные документы:**

- [Функциональные требования](./requirements.md)
- [Обзор проекта](../overview/project_overview.md)
- Модули системы: файлы в каталоге `docs/modules/`
